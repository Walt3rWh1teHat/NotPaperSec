## Скрипт составлен для активного сканирования веб-приложения с помощью OWASP-ZAP с VPS.

**Характеристики сканирования, которые дает скрипт:**
 - Spider + AJAX Spider + Active Scan (Standard) + Attack Mode
**Также функционал скрипта в результате:**
- Установится ZAP и zapv2.
- ZAP поднимется **в фоне** на `127.0.0.1:8090`.
- Скрипт переведёт ZAP в **Attack Mode**, создаст **Context** с правильным Regex, прогонит **Spider → AJAX Spider → Active Scan**.
- Сохранит **HTML** и **JSON** отчёты в папку `zap_results_YYYY-MM-DD_HH-MM-SS/`.
- Красиво **выключит** демон ZAP.


---

# Инструкция к использованию

## Подготовка чистого VPS:
### 1) Обновить пакеты (если сервер критичный — пропусти upgrade, чтобы не словить перезагрузку)

```
`#!/bin/bash`
`sudo apt update -y`
`sudo apt install -y curl wget git python3 python3-pip default-jre-headless unzip tmux`
```
### 2) (опционально) если snap ещё не стоит

```
#!/bin/bash
sudo apt install -y snapd
sudo systemctl enable --now snapd.socket
```

*Если твой провайдер режет snap в контейнерах — вместо snap можно использовать Docker-образ OWASP ZAP. Дам команды ниже, «Вариант B (Docker)».*

#### 2.1) Перетянуть файл из репозитория на VPS и сделать исполняемым.

**(все инструкции ниже в способе копирке)**

> [!NOTE]
> ## Способ через копирование кода(из файла sh):

### 3)Создать файл-скрипт и запустить

```
nano zap_autoscan.sh
```

В открытом редакторе вставляем код. После ctrl+S, ctrl+X 

Делаем исполняемым и запуск:

```
chmod +x zap_autoscan.sh
[^1]./zap_autoscan.sh https://твой-домен-и-либо-поддомен
```

Что произойдёт:

- Установится ZAP и zapv2.
    
- ZAP поднимется **в фоне** на `127.0.0.1:8090`.
    
- Скрипт переведёт ZAP в **Attack Mode**, создаст **Context** с правильным Regex, прогонит **Spider → AJAX Spider → Active Scan**.
    
- Сохранит **HTML** и **JSON** отчёты в папку `zap_results_YYYY-MM-DD_HH-MM-SS/`.
    
- Красиво **выключит** демон ZAP.

# Как смотреть прогресс и логи

Во время работы скрипт печатает прогресс.  
Дополнительно можно глянуть лог демона:

```
tail -f zap_results_*/zap_daemon.log
```

Проверить, что ZAP слушает локально:

```
`ss -lntp | grep 8090 # Должно быть: 127.0.0.1:8090 LISTEN java/OWASP ZAP`
```

---

# 4) Как скачать отчёты себе на локальный ПК

С локальной машины:

```
# HTML scp user@IP_VPS:~/zap_results_*/zap_report_*.html .  # JSON scp user@IP_VPS:~/zap_results_*/zap_report_*.json .
```

> Если домашняя папка другая — поправь путь.  
> Можно и одним архивом:
> 
```
> tar czf zap_reports.tar.gz zap_results_*/ scp user@IP_VPS:~/zap_reports.tar.gz .
```

---

# 5) Как «закончить» скан корректно

Скрипт сам шлёт `shutdown` через API. Если вдруг зависло — руками:

```
curl -s "http://127.0.0.1:8090/JSON/core/action/shutdown/?apikey=" # или, в крайнем случае pkill -f zaproxy
```

---

# 6) Как запустить несколько целей по очереди (батч)

Создай файл `targets.txt` со списком URL и:

```
while read -r url; do   [ -z "$url" ] && continue   ./zap_autoscan.sh "$url" done < targets.txt
```

---

# 7) Как включить/отключить ATTACK MODE вручную (если нужно отдельно)

Внутри Python-скрипта (есть уже в моём варианте):

```
zap.core.set_mode('attack')   # режим атаки # другие варианты: 'safe', 'protect', 'standard'
```

- **attack** — ZAP активно атакует всё новое в скоупе (и то, что нашёл Spider/AJAX).
    
- **standard** — обычный режим.
    
- **protect/safe** — более щадящие, без активных атак.

 

---


## Вариант B (Docker)


```
sudo apt install -y docker.io
docker run --rm -d --name zap -p 127.0.0.1:8090:8090 \
  owasp/zap2docker-stable \
  zap.sh -daemon -port 8090 -host 127.0.0.1 -config api.disablekey=true
```

Дальше запускаешь **тот же** Python-скрипт(он создаётся внутри моего большого `zap_autoscan.sh`, он коннектится по `127.0.0.1:8090`). 

```
 python3 zap_scan.py https://твой-сайт report.html report.json
```
 
— при условии, что у тебя ZAP уже поднят в контейнере и слушает на 127.0.0.1:8090.

Завершение:

```
curl -s "http://127.0.0.1:8090/JSON/core/action/shutdown/?apikey=" 
docker rm -f zap
```

## **Готово!** 

> [!NOTE]
> Если возникает ошибка 403/JS-челендж, то придется в ручную собирать API-хуки, cookie/User-Agent и т.п. В таком случае лучше прокидывать прокси ZAP через свой браузер и пройти WAF руками перед запуском скана(через API), чтобы данные сохранились в ZAP. 


[^1]: Вот тут прописать путь до файла-скрипта.sh

